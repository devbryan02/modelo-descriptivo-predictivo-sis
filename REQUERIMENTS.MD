# Requirements Document - Sistema de AnÃ¡lisis del SIS

## ğŸ“‹ InformaciÃ³n General del Proyecto

**Nombre:** Modelo de AnÃ¡lisis Descriptivo y Predictivo para la IdentificaciÃ³n de Patrones en las Atenciones del Seguro Integral de Salud (SIS)

**Objetivo Principal:** Desarrollar un sistema backend con FastAPI que procese, analice y prediga patrones en las atenciones mÃ©dicas del SIS, exponiendo resultados mediante una API REST consumida por un frontend en Next.js.

**Stack TecnolÃ³gico:**
- Backend: Python 3.10+, FastAPI, SQLAlchemy, Alembic
- Base de Datos: PostgreSQL
- ML/Data Science: scikit-learn, pandas, numpy
- Testing: pytest
- Frontend (futuro): Next.js

---

## ğŸ¯ Contexto del Negocio

### Entidad: Seguro Integral de Salud (SIS) - PerÃº
- InstituciÃ³n pÃºblica del Ministerio de Salud (MINSA)
- Garantiza acceso a servicios de salud para poblaciÃ³n vulnerable
- Gestiona mÃºltiples planes: SIS Gratuito, Independiente, NRUS, Microempresas, Para Todos
- Trabaja con IPRESS (Instituciones Prestadoras de Servicios de Salud) en 3 niveles (I, II, III)

### Problema a Resolver
- Millones de atenciones mÃ©dicas sin anÃ¡lisis sistemÃ¡tico
- Falta de herramientas para anticipar demanda de servicios
- Datos dispersos sin integraciÃ³n
- Procesos manuales de anÃ¡lisis
- Dificultad para detectar patrones o planificar recursos

---

## ğŸ“Š Modelo de Datos

### Variables Clave del Dataset

| Variable | Tipo | DescripciÃ³n |
|----------|------|-------------|
| AÃ‘O | NumÃ©rica | AÃ±o de la atenciÃ³n mÃ©dica |
| MES | NumÃ©rica | Mes de la atenciÃ³n (1-12) |
| REGIÃ“N | CategÃ³rica | RegiÃ³n donde se brindÃ³ la atenciÃ³n |
| PROVINCIA | CategÃ³rica | Provincia de la atenciÃ³n |
| DISTRITO | CategÃ³rica | Distrito/ubicaciÃ³n del establecimiento |
| SEXO | CategÃ³rica | Masculino/Femenino |
| GRUPO_EDAD | CategÃ³rica | Rangos: 00-04, 05-11, 12-17, 18-29, 30-59, 60+ |
| PLAN_DE_SEGURO | CategÃ³rica | Gratuito, Independiente, NRUS, Microempresa, Para Todos |
| NIVEL_EESS | CategÃ³rica | Nivel del establecimiento (I, II, III) |
| DESC_SERVICIO | CategÃ³rica | Tipo de servicio mÃ©dico brindado |
| ATENCIONES | NumÃ©rica | NÃºmero total de atenciones registradas |

### Esquema de Base de Datos (PostgreSQL)

**Tablas OLTP:**
- `pacientes`: datos demogrÃ¡ficos (sexo, grupo_etario, tipo_seguro)
- `ipress`: establecimientos de salud (nombre, nivel, ubicaciÃ³n)
- `servicios`: catÃ¡logo de servicios mÃ©dicos
- `planes_seguro`: tipos de planes SIS
- `regiones`: estructura geogrÃ¡fica (regiÃ³n, provincia, distrito, ubigeo)
- `atenciones`: registro principal (FK a todas las anteriores)

**Vistas AnalÃ­ticas:**
- `vw_resumen_atenciones`: totales por aÃ±o, mes, regiÃ³n
- `vw_atenciones_por_servicio`: distribuciÃ³n por tipo de servicio
- `vw_atenciones_por_plan`: agrupadas por plan de seguro
- `vw_atenciones_por_edad_y_sexo`: segmentaciÃ³n demogrÃ¡fica

---

## ğŸ—ï¸ Arquitectura de la AplicaciÃ³n

### Estructura de Carpetas

```
MODELO-PREDICCION-SIS/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ endpoints/       # Controladores (atencion.py, prediccion.py)
â”‚   â”‚   â””â”€â”€ routes/          # Rutas principales de la API
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ config.py        # Variables de entorno
â”‚   â”‚   â”œâ”€â”€ database.py      # ConexiÃ³n a PostgreSQL
â”‚   â”‚   â””â”€â”€ settings.py      # ConfiguraciÃ³n global
â”‚   â”œâ”€â”€ models/              # SQLAlchemy ORM models
â”‚   â”‚   â””â”€â”€ atencion.py
â”‚   â”œâ”€â”€ schemas/             # Pydantic schemas para validaciÃ³n
â”‚   â”‚   â””â”€â”€ atencion_schema.py
â”‚   â”œâ”€â”€ services/            # LÃ³gica de negocio (crear si no existe)
â”‚   â”œâ”€â”€ ml/                  # Modelos de ML (crear si no existe)
â”‚   â”‚   â”œâ”€â”€ predictor.py
â”‚   â”‚   â”œâ”€â”€ models/          # Modelos entrenados (.pkl)
â”‚   â”‚   â””â”€â”€ training/        # Scripts de entrenamiento
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ load_csv_to_db.py
â”‚   â”œâ”€â”€ static/
â”‚   â”‚   â””â”€â”€ dataset.csv      # Dataset del SIS
â”‚   â””â”€â”€ main.py              # Entry point FastAPI
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ load_data.py         # Script ETL
â”œâ”€â”€ alembic/                 # Migraciones de BD
â”œâ”€â”€ tests/                   # Tests unitarios/integraciÃ³n
â””â”€â”€ requirements.txt
```

---

## ğŸ”§ Funcionalidades Requeridas

### 1. API REST con FastAPI

#### Endpoints de AnÃ¡lisis Descriptivo
- `GET /api/v1/atenciones/estadisticas`
  - Query params: aÃ±o, mes, regiÃ³n, plan_seguro
  - Retorna: totales, promedios, distribuciones
  
- `GET /api/v1/atenciones/por-region`
  - Agrupa atenciones por regiÃ³n geogrÃ¡fica
  
- `GET /api/v1/atenciones/por-edad-sexo`
  - SegmentaciÃ³n demogrÃ¡fica
  
- `GET /api/v1/atenciones/por-servicio`
  - DistribuciÃ³n por tipo de servicio mÃ©dico

#### Endpoints de PredicciÃ³n
- `POST /api/v1/prediccion/demanda`
  - Body: `{aÃ±o, mes, regiÃ³n, grupo_edad, sexo, plan_seguro}`
  - Retorna: predicciÃ³n de nÃºmero de atenciones
  
- `POST /api/v1/prediccion/batch`
  - PredicciÃ³n masiva para mÃºltiples escenarios

#### Endpoints de GestiÃ³n
- `POST /api/v1/data/load-csv` (admin)
  - Carga masiva desde CSV al OLTP
  
- `GET /api/v1/health`
  - Healthcheck de la API y conexiÃ³n a BD

### 2. Procesamiento de Datos

**Limpieza y TransformaciÃ³n:**
- Eliminar duplicados
- ImputaciÃ³n de valores nulos (moda para categÃ³ricas, mediana para numÃ©ricas)
- EstandarizaciÃ³n de formatos (fechas, texto)
- ValidaciÃ³n de integridad referencial
- Filtrado de registros inconsistentes

**Feature Engineering:**
- Derivar: total_atenciones_por_paciente, promedio_mensual_por_region
- Agrupar categorÃ­as redundantes
- Crear variables temporales: aÃ±o, mes, trimestre
- Clasificar grupos etarios: 0-11, 12-17, 18-59, 60+

**CodificaciÃ³n para ML:**
- One-Hot Encoding: sexo, tipo_seguro, regiÃ³n, servicio
- Label Encoding: nivel_ipress
- StandardScaler: variables numÃ©ricas

### 3. Modelos de Machine Learning

**Objetivo:** Predecir la demanda futura de atenciones mÃ©dicas

**Modelos a implementar:**
- RegresiÃ³n Lineal (baseline)
- Random Forest Regressor
- Gradient Boosting (XGBoost/LightGBM)
- Opcionalmente: LSTM para series temporales

**MÃ©tricas de evaluaciÃ³n:**
- RÂ² (coeficiente de determinaciÃ³n)
- RMSE (Root Mean Squared Error)
- MAE (Mean Absolute Error)

**Pipeline ML:**
1. Preprocesamiento (escalado, codificaciÃ³n)
2. Entrenamiento con train/test split (80/20)
3. ValidaciÃ³n cruzada
4. SerializaciÃ³n del modelo (joblib/pickle)
5. Carga del modelo en la API

---

## ğŸ“ Reglas de Negocio

1. **ValidaciÃ³n de Datos:**
   - AÃ±os vÃ¡lidos: 2020-2025
   - Meses: 1-12
   - Grupos de edad deben seguir los rangos establecidos
   - Sexo: solo "Masculino" o "Femenino"

2. **Filtros de Consulta:**
   - Permitir filtrado mÃºltiple por regiÃ³n, aÃ±o, mes, plan
   - PaginaciÃ³n en endpoints que retornen muchos registros

3. **Seguridad:**
   - AutenticaciÃ³n JWT (futuro)
   - Rate limiting para prevenir abuso
   - Logs de auditorÃ­a para operaciones crÃ­ticas

4. **Performance:**
   - Cache de consultas frecuentes (Redis, futuro)
   - Ãndices en PostgreSQL para campos filtrados
   - Queries optimizadas con SQLAlchemy

---

## ğŸ§ª Testing

**Tipos de tests requeridos:**
- Unitarios: modelos, schemas, utilidades
- IntegraciÃ³n: endpoints de la API
- E2E: flujo completo de carga â†’ anÃ¡lisis â†’ predicciÃ³n

**Cobertura mÃ­nima:** 70%

**Herramientas:**
- pytest
- pytest-cov
- httpx (para tests de FastAPI)

---

## ğŸš€ Deploy y Entorno

**Variables de Entorno (.env):**
```
DATABASE_URL=postgresql://user:password@localhost:5432/sis_db
SECRET_KEY=your-secret-key
DEBUG=True
API_VERSION=v1
```

**Comandos principales:**
```bash
# Instalar dependencias
pip install -r requirements.txt

# Ejecutar migraciones
alembic upgrade head

# Cargar datos iniciales
python scripts/load_data.py

# Ejecutar servidor de desarrollo
uvicorn app.main:app --reload

# Ejecutar tests
pytest tests/ -v --cov=app
```

---

## ğŸ“š Dependencias Principales

**Backend:**
- fastapi
- uvicorn[standard]
- sqlalchemy
- psycopg2-binary
- alembic
- pydantic
- python-dotenv

**Data Science:**
- pandas
- numpy
- scikit-learn
- joblib
- matplotlib
- seaborn

**Testing:**
- pytest
- pytest-cov
- httpx

---

## ğŸ¨ Convenciones de CÃ³digo

- **Estilo:** PEP 8
- **Nombrado:**
  - Archivos: snake_case
  - Clases: PascalCase
  - Funciones/variables: snake_case
  - Constantes: UPPER_CASE
- **Docstrings:** Google Style
- **Type hints:** obligatorios en funciones pÃºblicas

---

## ğŸ”® Roadmap Futuro

**Fase 1 (Actual):**
- âœ… Estructura del proyecto
- âœ… Modelos de BD
- âœ… Endpoints bÃ¡sicos
- â³ Pipeline de ML

**Fase 2:**
- AutenticaciÃ³n y autorizaciÃ³n
- Dashboard en Next.js
- Cache con Redis
- DockerizaciÃ³n

**Fase 3:**
- Despliegue en producciÃ³n
- Monitoreo con Prometheus/Grafana
- CI/CD con GitHub Actions
- DocumentaciÃ³n con Swagger/ReDoc

---

## ğŸ‘¥ Equipo

- Cardenas MuÃ±oz, Brayan Yonque
- Conde NuÃ±ez, Percy Emerson
- HuamÃ¡n Mallqui, Abdias Eri
- Lopez Quispe, Brady
- Mitma Arango, Pilar Dana
- Trejo Gavilan, Mavel Leonor

**Docente:** Jhonatan Jurado

---

## ğŸ“– Referencias

- [DocumentaciÃ³n FastAPI](https://fastapi.tiangolo.com/)
- [SQLAlchemy ORM](https://docs.sqlalchemy.org/)
- [Scikit-learn](https://scikit-learn.org/)
- [PostgreSQL Docs](https://www.postgresql.org/docs/)

---

**Ãšltima actualizaciÃ³n:** Octubre 2025